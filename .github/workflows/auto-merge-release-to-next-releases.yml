name: Auto-merge releas to next releases
on:
  push:
    branches:
      - 'release-[0-9]+.[0-9]+.[0-9]+'
jobs:
  auto-merge-rc-job:
    runs-on: ubuntu-20.04
    steps:
      - name: Check out repository code
        uses: actions/checkout@v1
      - name: Auto-merge
        uses: sergeevichvn/gh-action-nightly-merge@v1.3.5
        env:
          GITHUB_TOKEN: ${{ secrets.GIT_ACCESS_TOKEN }}
      - name: Send message to Telegram chat
        continue-on-error: true
        id: sendMessageToTelegram
        if: failure()
        uses: dawidd6/action-send-mail@v3.6.0
        with:
          # Required mail server address:
          server_address: smtp.gmail.com
          # Required mail server port:
          server_port: 465
          # Optional (recommended): mail server username:
          username: ${{secrets.FROM_MAIL_USERNAME}}
          # Optional (recommended) mail server password:
          password: ${{secrets.MAIL_PASSWORD}}
          # Required mail subject:
          subject: Github Actions job result
          # Required recipients' addresses:
          to: semenovio@sovcombank.ru
          # Required sender full name (address can be skipped):
          from: semyonov.o2001@gmail.com
          # Optional plain body:
          body: |
            ðŸ”¥ [AUTO-MERGE FAIL](https://github.com/${{github.repository}}/actions/runs/${{github.run_id}})
            Repository: [${{ github.repository }}](https://github.com/${{ github.repository }})
            Author of PR: [${{ github.actor }}](https://github.com/${{ github.actor }})
            message to telegram
            message to telegram
            message to telegram
            message to telegram
            message to telegram
            message to telegram
            message to telegram
            message to telegram
            message to telegram
            message to telegram
      - name: Check on failure step "sendMessageToTelegram"
        if: (${{ success() }} || ${{ failure() }}) && (${{ steps.sendMessageToTelegram.outcome }} == failure)
        uses: dawidd6/action-send-mail@v3.6.0
        with:
          # Required mail server address:
          server_address: smtp.gmail.com
          # Required mail server port:
          server_port: 465
          # Optional (recommended): mail server username:
          username: ${{secrets.FROM_MAIL_USERNAME}}
          # Optional (recommended) mail server password:
          password: ${{secrets.MAIL_PASSWORD}}
          # Required mail subject:
          subject: Github Actions job result
          # Required recipients' addresses:
          to: semenovio@sovcombank.ru
          # Required sender full name (address can be skipped):
          from: semyonov.o2001@gmail.com

          # Optional plain body:
          body: |
            ðŸ”¥ [AUTO-MERGE FAIL](https://github.com/${{github.repository}}/actions/runs/${{github.run_id}})
            Repository: [${{ github.repository }}](https://github.com/${{ github.repository }})
            Author of PR: [${{ github.actor }}](https://github.com/${{ github.actor }})
            Error sending message to Telegram chat
            Error sending message to Telegram chat
            Error sending message to Telegram chat
            Error sending message to Telegram chat
            Error sending message to Telegram chat
            Error sending message to Telegram chat
            Error sending message to Telegram chat
            Error sending message to Telegram chat